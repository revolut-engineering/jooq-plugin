# Gradle 9.3.1 Compatibility Update

**Date:** 2026-02-09
**Status:** Approved
**Approach:** Minimal update (version bump and test validation)

## Overview

Update the jooq-plugin to support Gradle 9.3.1 while maintaining backward compatibility with Gradle 8.X.X versions.

## Scope and Strategy

This is a straightforward version compatibility update. Since the plugin was recently upgraded to support Gradle 9.1.0 (commit 0a34205), and we're moving to 9.3.1 (a patch version increment), we expect no breaking API changes.

### Strategy
1. Update the Gradle wrapper from 9.1.0 to 9.3.1
2. Add 9.3.1 to the test matrix alongside existing versions (8.8, 8.14, 9.1.0)
3. Run the functional test suite to validate compatibility
4. Maintain existing backward compatibility with 8.X.X versions

### Why This Approach Works

The plugin uses standard Gradle APIs (tasks, extensions, configurations) that are stable across minor/patch versions. The recent 9.1.0 upgrade already addressed any breaking changes in the 9.x line. Moving from 9.1.0 to 9.3.1 should be seamless since:

- No deprecated Gradle APIs are used in the plugin code
- The plugin doesn't rely on internal Gradle APIs
- Configuration cache support (added in 9.1.0) is already implemented
- The test matrix approach ensures multi-version compatibility is validated

## Implementation Changes

### 1. Gradle Wrapper Update (build.gradle.kts)

**File:** `build.gradle.kts`

Update the wrapper task configuration:
```kotlin
wrapper {
    gradleVersion = "9.3.1"  // Changed from "9.1.0"
    distributionType = ALL
}
```

This will update `gradle/wrapper/gradle-wrapper.properties` when you run `./gradlew wrapper`.

### 2. Test Matrix Extension (GradleMatrixTest.kt)

**File:** `src/testFunctional/kotlin/com/revolut/jooq/GradleMatrixTest.kt`

Add Gradle 9.3.1 to the test matrix annotation (around line 54-70):
```kotlin
@GradleMatrixTest(
    matrix: Array<GradleVersionConfiguration> = [
        GradleVersionConfiguration("8.8", maxSupportedJavaVersion = VERSION_22, supportsConfigurationCache = true),
        GradleVersionConfiguration("8.14", maxSupportedJavaVersion = VERSION_24, supportsConfigurationCache = true),
        GradleVersionConfiguration("9.1.0", maxSupportedJavaVersion = VERSION_24, supportsConfigurationCache = true),
        GradleVersionConfiguration("9.3.1", maxSupportedJavaVersion = VERSION_24, supportsConfigurationCache = true),  // NEW
    ],
)
```

### 3. No Plugin Code Changes Required

The plugin implementation code requires no changes because:
- It only uses stable Gradle APIs (Plugin, Project, Task, Configuration)
- No version-specific code paths exist
- The abstractions are compatible across all target versions

## Testing and Validation

### Automated Test Coverage

The existing test suite will automatically validate 9.3.1 compatibility once added to the matrix:

1. **MultiVersionCompatibilitySpec** - Tests basic plugin functionality across all Gradle versions
2. **FunctionalSpec** - Base test class providing testing utilities
3. **Test execution** - The `@GradleMatrixTest` annotation ensures each test runs 4 times (once per Gradle version)

### What Gets Validated

- Plugin applies correctly to projects
- Task registration and configuration works
- Docker container lifecycle management
- Flyway migration execution
- jOOQ code generation
- Configuration cache compatibility
- Java toolchain integration

### Validation Steps

1. Run `./gradlew wrapper` to update wrapper files
2. Run `./gradlew testFunctional` to execute the full functional test suite
3. Verify all tests pass for Gradle 9.3.1 (and still pass for 8.8, 8.14, 9.1.0)

### Expected Outcome

All tests should pass without modification since we're not changing plugin behavior, just extending the supported version range. If any test fails specifically on 9.3.1, it would indicate a breaking change in Gradle itself (unlikely for a patch version).

## Backward Compatibility

### Compatibility Strategy

The plugin maintains compatibility with Gradle 8.X.X through:
- **No version-specific code** - The plugin doesn't check Gradle version or branch behavior
- **Stable API usage** - Only uses APIs that exist in Gradle 8.8+
- **Test matrix validation** - Oldest supported version (8.8) is tested on every change

### Version Support Policy

After this change, the officially supported and tested versions will be:
- Gradle 8.8 (oldest 8.x in test matrix)
- Gradle 8.14 (latest 8.x in test matrix)
- Gradle 9.1.0 (first 9.x version)
- Gradle 9.3.1 (latest 9.x version)

Versions between these (e.g., 8.9, 8.10, 9.2) should work but aren't explicitly tested. Users on older versions (< 8.8) may encounter issues and should upgrade.

## Rollback Plan

If 9.3.1 tests fail unexpectedly, simply remove it from the test matrix and keep 9.1.0 as the highest supported version until the issue is investigated.

## Summary of Changes

| File | Change | Line(s) |
|------|--------|---------|
| build.gradle.kts | Update gradleVersion to "9.3.1" | ~62 |
| src/testFunctional/kotlin/com/revolut/jooq/GradleMatrixTest.kt | Add new GradleVersionConfiguration for 9.3.1 | ~66-69 |
| gradle/wrapper/* | Auto-updated by running `./gradlew wrapper` | N/A |

## Implementation Steps

1. Update `build.gradle.kts` wrapper configuration
2. Update `GradleMatrixTest.kt` test matrix
3. Run `./gradlew wrapper` to regenerate wrapper files
4. Run `./gradlew testFunctional` to validate all tests pass
5. Commit changes with appropriate message